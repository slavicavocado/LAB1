#include <stdio.h>
#include <pthread.h>
#include <semaphore.h>

// Глобальная переменная для хранения результата вычисления факториала
unsigned long long result = 1;

// Семафор для синхронизации доступа к глобальной переменной
sem_t mutex;

// Функция для вычисления факториала числа
void *factorial(void *arg) {
    unsigned int n = *((unsigned int*)arg);

    // Базовый случай: факториал 0 равен 1
    if (n == 0) {
        result = 1;
    } else {
        // Рекурсивный случай: вычисляем факториал числа n как n * (n - 1)!
        for (unsigned int i = 1; i <= n; ++i) {
            sem_wait(&mutex); // Захватываем семафор перед доступом к общему ресурсу
            result *= i;
            sem_post(&mutex); // Освобождаем семафор после завершения доступа к общему ресурсу
        }
    }

    return NULL;
}

int main() {
    unsigned int number;

    // Ввод числа от пользователя
    printf("Введите число для вычисления его факториала: ");
    scanf("%u", &number);

    // Проверка на отрицательное число
    if (number < 0) {
        printf("Факториал отрицательного числа не определен.\n");
    } else {
        // Инициализация семафора
        sem_init(&mutex, 0, 1);

        // Создание потока
        pthread_t thread;
        pthread_create(&thread, NULL, factorial, &number);

        // Ожидание завершения потока
        pthread_join(thread, NULL);

        // Вывод результата
        printf("Факториал числа %u равен %llu\n", number, result);

        // Уничтожение семафора
        sem_destroy(&mutex);
    }

    return 0;
}
Этот код создает отдельный поток для вычисления факториала числа. Семафор mutex используется для синхронизации доступа к глобальной переменной result. Перед доступом к переменной поток захватывает семафор, а после завершения работы с переменной освобождает его. Это гарантирует корректное обновление значения переменной result в многопоточной среде.